version: '2.1'

services:
  app:
    extends:
      file: ./docker-compose.yml
      service: app

  selenium:
    image: selenium/hub:3.2.0
    links:
      - app
    expose:
      - '4444'
    ports:
      - '4444:4444' # Selenium Grid
    depends_on:
      - browser
    environment:
      - SE_OPTS=-debug true

  browser:
    image: "selenium/node-${BROWSER:-chrome}-debug:3.2.0"
    environment:
      # These are legacy compose links env vars that the image is relying on.
      - HUB_PORT_4444_TCP_PORT=4444
      - HUB_PORT_4444_TCP_ADDR=selenium
    depends_on:
      - app
    ports:
      - '5900:5900' # VNC

  acceptance_debug:
    extends:
      service: app
    links:
      - selenium
    environment:
      - BROWSER=${BROWSER:-chrome}
    command: npm run _test:acceptance:debug
    ports:
      - '9229:9229' # node --inspect
