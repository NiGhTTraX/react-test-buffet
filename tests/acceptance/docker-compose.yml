version: '2.1'

services:
  app:
    extends:
      file: ../../docker-compose.yml
      service: app
    environment:
      # Path is relative to the location of the dev server.
      - WEBPACK_CONFIG=./acceptance/webpack.config.acceptance.js
    expose:
      - '3000'
    volumes:
      - ./screenshots:/usr/src/app/tests/acceptance/screenshots

  selenium:
    image: selenium/hub:3.2.0
    expose:
      - '4444'
    depends_on:
      - chrome
      - firefox

  chrome:
    image: selenium/node-chrome:3.2.0
    environment:
      # These are legacy compose links env vars that the image is relying on.
      - HUB_PORT_4444_TCP_PORT=4444
      - HUB_PORT_4444_TCP_ADDR=selenium
    depends_on:
      - app

  firefox:
    image: selenium/node-firefox:3.2.0
    environment:
      # These are legacy compose links env vars that the image is relying on.
      - HUB_PORT_4444_TCP_PORT=4444
      - HUB_PORT_4444_TCP_ADDR=selenium
    depends_on:
      - app

  acceptance_chrome:
    extends:
      service: app
    links:
      - selenium
    environment:
      - BROWSER=chrome
    command: npm run _test:acceptance

  acceptance_firefox:
    extends:
      service: app
    links:
      - selenium
    environment:
      - BROWSER=firefox
    command: npm run _test:acceptance
